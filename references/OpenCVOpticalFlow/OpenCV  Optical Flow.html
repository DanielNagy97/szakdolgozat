<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta name="generator" content="Doxygen 1.8.12">
<title>OpenCV: Optical Flow</title>
<link href="https://docs.opencv.org/3.4/opencv.ico" rel="shortcut icon" type="image/x-icon">
<link href="OpenCV%20%20Optical%20Flow_elemei/tabs.css" rel="stylesheet" type="text/css">
<script async="" src="OpenCV%20%20Optical%20Flow_elemei/async-ads.js"></script><script type="text/javascript" async="" src="OpenCV%20%20Optical%20Flow_elemei/cse.js"></script><script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/jquery.js"></script>
<script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/dynsections.js"></script>
<script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/tutorial-utils.js"></script>
<link href="OpenCV%20%20Optical%20Flow_elemei/search.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/searchdata.js"></script>
<script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/search.js"></script>
<script type="text/x-mathjax-config;executed=true">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/MathJax.js"></script><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style>
<link href="OpenCV%20%20Optical%20Flow_elemei/doxygen.css" rel="stylesheet" type="text/css">
<link href="OpenCV%20%20Optical%20Flow_elemei/stylesheet.css" rel="stylesheet" type="text/css">
<script src="OpenCV%20%20Optical%20Flow_elemei/cse_element__en.js" type="text/javascript"></script><link type="text/css" rel="stylesheet" href="OpenCV%20%20Optical%20Flow_elemei/defaulten.css"><link type="text/css" rel="stylesheet" href="OpenCV%20%20Optical%20Flow_elemei/default.css"><style type="text/css">.gsc-control-cse{font-family:arial, sans-serif}.gsc-control-cse .gsc-table-result{font-family:arial, sans-serif}.gsc-refinementsGradient{background:linear-gradient(to left,rgba(255,255,255,1),rgba(255,255,255,0))}.gsc-control-cse{border-color:#FFFFFF;background-color:#FFFFFF}input.gsc-input,.gsc-input-box,.gsc-input-box-hover,.gsc-input-box-focus{border-color:#D9D9D9}.gsc-search-button-v2,.gsc-search-button-v2:hover,.gsc-search-button-v2:focus{border-color:#666666;background-color:#CECECE;background-image:none;filter:none}.gsc-search-button-v2 svg{fill:#FFFFFF}.gsc-tabHeader.gsc-tabhActive,.gsc-refinementHeader.gsc-refinementhActive{color:#CCCCCC;border-color:#CCCCCC;background-color:#FFFFFF}.gsc-tabHeader.gsc-tabhInactive,.gsc-refinementHeader.gsc-refinementhInactive{color:#CCCCCC;border-color:#CCCCCC;background-color:#FFFFFF}.gsc-webResult.gsc-result,.gsc-results .gsc-imageResult{border-color:#FFFFFF;background-color:#FFFFFF}.gsc-webResult.gsc-result:hover,.gsc-imageResult:hover{border-color:#FFFFFF;background-color:#FFFFFF}.gs-webResult.gs-result a.gs-title:link,.gs-webResult.gs-result a.gs-title:link b,.gs-imageResult a.gs-title:link,.gs-imageResult a.gs-title:link b{color:#0000CC}.gs-webResult.gs-result a.gs-title:visited,.gs-webResult.gs-result a.gs-title:visited b,.gs-imageResult a.gs-title:visited,.gs-imageResult a.gs-title:visited b{color:#0000CC}.gs-webResult.gs-result a.gs-title:hover,.gs-webResult.gs-result a.gs-title:hover b,.gs-imageResult a.gs-title:hover,.gs-imageResult a.gs-title:hover b{color:#0000CC}.gs-webResult.gs-result a.gs-title:active,.gs-webResult.gs-result a.gs-title:active b,.gs-imageResult a.gs-title:active,.gs-imageResult a.gs-title:active b{color:#0000CC}.gsc-cursor-page{color:#0000CC}a.gsc-trailing-more-results:link{color:#0000CC}.gs-webResult .gs-snippet,.gs-imageResult .gs-snippet,.gs-fileFormatType{color:#000000}.gs-webResult div.gs-visibleUrl,.gs-imageResult div.gs-visibleUrl{color:#008000}.gs-webResult div.gs-visibleUrl-short{color:#008000}.gs-webResult div.gs-visibleUrl-short{display:none}.gs-webResult div.gs-visibleUrl-long{display:block}.gs-promotion div.gs-visibleUrl-short{display:none}.gs-promotion div.gs-visibleUrl-long{display:block}.gsc-cursor-box{border-color:#FFFFFF}.gsc-results .gsc-cursor-box .gsc-cursor-page{border-color:#CCCCCC;background-color:#FFFFFF;color:#CCCCCC}.gsc-results .gsc-cursor-box .gsc-cursor-current-page{border-color:#CCCCCC;background-color:#FFFFFF;color:#CCCCCC}.gsc-webResult.gsc-result.gsc-promotion{border-color:#336699;background-color:#FFFFFF}.gsc-completion-title{color:#0000CC}.gsc-completion-snippet{color:#000000}.gs-promotion a.gs-title:link,.gs-promotion a.gs-title:link *,.gs-promotion .gs-snippet a:link{color:#0000CC}.gs-promotion a.gs-title:visited,.gs-promotion a.gs-title:visited *,.gs-promotion .gs-snippet a:visited{color:#0000CC}.gs-promotion a.gs-title:hover,.gs-promotion a.gs-title:hover *,.gs-promotion .gs-snippet a:hover{color:#0000CC}.gs-promotion a.gs-title:active,.gs-promotion a.gs-title:active *,.gs-promotion .gs-snippet a:active{color:#0000CC}.gs-promotion .gs-snippet,.gs-promotion .gs-title .gs-promotion-title-right,.gs-promotion .gs-title .gs-promotion-title-right *{color:#000000}.gs-promotion .gs-visibleUrl,.gs-promotion .gs-visibleUrl-short{color:#008000}.gcsc-find-more-on-google{color:#0000CC}.gcsc-find-more-on-google-magnifier{fill:#0000CC}</style><style type="text/css">.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;position:relative;user-select:none;-moz-user-select:none;white-space:nowrap}.gsst_e{vertical-align:middle;opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsq_a{padding:0}.gsq_a{padding:0}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gssb_a{padding:0 9px}.gsib_a{padding:5px 9px 4px 9px}.gscb_a{line-height:27px}.gssb_e{border:0}.gssb_l{margin:5px 0}input.gsc-input::-webkit-input-placeholder{font-size:14px}input.gsc-input:-moz-placeholder{font-size:14px}input.gsc-input::-moz-placeholder{font-size:14px}input.gsc-input:-ms-input-placeholder{font-size:14px}input.gsc-input:focus::-webkit-input-placeholder{color:transparent}input.gsc-input:focus:-moz-placeholder{color:transparent}input.gsc-input:focus::-moz-placeholder{color:transparent}input.gsc-input:focus:-ms-input-placeholder{color:transparent}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.0') format('opentype'); font-weight: bold}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.0') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Math; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.0') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.0') format('opentype')}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style></head>
<body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<script>
  (function() {
    var cx = '002541620211387084530:kaexgxg7oxu';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div id="___gcse_0"><div class="gsc-control-cse gsc-control-cse-en"><div class="gsc-control-wrapper-cse" dir="ltr"><form class="gsc-search-box gsc-search-box-tools" accept-charset="utf-8"><table class="gsc-search-box" cellspacing="0" cellpadding="0"><tbody><tr><td class="gsc-input"><div class="gsc-input-box" id="gsc-iw-id1"><table style="width: 100%; padding: 0px;" id="gs_id50" class="gstl_50 gsc-input" cellspacing="0" cellpadding="0"><tbody><tr><td id="gs_tti50" class="gsib_a"><input autocomplete="off" type="text" size="10" class="gsc-input" name="search" title="search" style="width: 100%; padding: 0px; border: medium none; margin: 0px; height: auto; background: rgb(255, 255, 255) url(&quot;https://www.google.com/cse/static/images/1x/googlelogo_lightgrey_46x16dp.png&quot;) no-repeat scroll left center; text-indent: 48px; outline: currentcolor none medium;" id="gsc-i-id1" placeholder="Custom Search" dir="ltr" spellcheck="false" x-webkit-grammar="builtin:search" lang="en"></td><td class="gsib_b"><div class="gsst_b" id="gs_st50" dir="ltr"><a class="gsst_a" href="javascript:void(0)" style="display: none;" title="Clear search box" role="button"><span class="gscb_a" id="gs_cb50" aria-hidden="true">×</span></a></div></td></tr></tbody></table></div></td><td class="gsc-search-button"><button class="gsc-search-button gsc-search-button-v2"><svg width="13" height="13" viewBox="0 0 13 13"><title>search</title><path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z"></path></svg></button></td><td class="gsc-clear-button"><div class="gsc-clear-button" title="clear results">&nbsp;</div></td></tr></tbody></table></form><div class="gsc-results-wrapper-overlay"><div class="gsc-results-close-btn" tabindex="0"></div><div class="gsc-positioningWrapper"><div class="gsc-tabsAreaInvisible"><div class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Custom Search</div><span class="gs-spacer"> </span></div></div><div class="gsc-positioningWrapper"><div class="gsc-tabsAreaInvisible"></div></div><div class="gsc-above-wrapper-area-invisible"><table class="gsc-above-wrapper-area-container" cellspacing="0" cellpadding="0"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td><td class="gsc-orderby-container"><div class="gsc-orderby-invisible"><div class="gsc-orderby-label gsc-inline-block">Sort by:</div><div class="gsc-option-menu-container gsc-inline-block"><div class="gsc-selected-option-container gsc-inline-block"><div class="gsc-selected-option">Relevance</div><div class="gsc-option-selector"></div></div><div class="gsc-option-menu-invisible"><div class="gsc-option-menu-item gsc-option-menu-item-highlighted"><div class="gsc-option">Relevance</div></div><div class="gsc-option-menu-item"><div class="gsc-option">Date</div></div></div></div></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><div><div class="gsc-expansionArea"></div></div></div></div></div></div><div class="gsc-modal-background-image" tabindex="0"></div></div></div></div>
<script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/version.js"></script>

<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OpenCV%20%20Optical%20Flow_elemei/opencv-logo-small.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &nbsp;<span id="projectnumber"><select><option value="4.1.2-dev">4.1.2-dev</option><option value="4.1.2">4.1.2</option><option value="4.1.1">4.1.1</option><option value="4.1.0">4.1.0</option><option value="4.0.1">4.0.1</option><option value="4.0.0">4.0.0</option><option value="4.0.0-rc">4.0.0-rc</option><option value="4.0.0-beta">4.0.0-beta</option><option value="4.0.0-alpha">4.0.0-alpha</option><option value="3.4.8-dev" selected="selected">3.4.8-dev</option><option value="3.4.8">3.4.8</option><option value="3.4.7">3.4.7</option><option value="3.4.6">3.4.6</option><option value="3.4.5">3.4.5</option><option value="3.4.4">3.4.4</option><option value="3.4.3">3.4.3</option><option value="3.4.2">3.4.2</option><option value="3.4.1">3.4.1</option><option value="3.4.0">3.4.0</option><option value="3.3.1">3.3.1</option><option value="3.3.0">3.3.0</option><option value="3.2.0">3.2.0</option><option value="3.1.0">3.1.0</option><option value="3.0.0">3.0.0</option></select></span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/menudata.js"></script>
<script type="text/javascript" src="OpenCV%20%20Optical%20Flow_elemei/menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"><ul class="sm sm-dox" id="main-menu" data-smartmenus-id="15715939272566555"><li><a href="https://docs.opencv.org/3.4/index.html">Main Page</a></li><li><a href="https://docs.opencv.org/3.4/pages.html">Related Pages</a></li><li><a href="https://docs.opencv.org/3.4/modules.html">Modules</a></li><li><a href="https://docs.opencv.org/3.4/namespaces.html" class="has-submenu" id="sm-15715939272566555-1" aria-haspopup="true" aria-controls="sm-15715939272566555-2" aria-expanded="false"><span class="sub-arrow">+</span>Namespaces</a><ul id="sm-15715939272566555-2" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-1" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/namespaces.html">Namespace List</a></li></ul></li><li><a href="https://docs.opencv.org/3.4/annotated.html" class="has-submenu" id="sm-15715939272566555-3" aria-haspopup="true" aria-controls="sm-15715939272566555-4" aria-expanded="false"><span class="sub-arrow">+</span>Classes</a><ul id="sm-15715939272566555-4" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-3" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/annotated.html">Class List</a></li><li><a href="https://docs.opencv.org/3.4/classes.html">Class Index</a></li></ul></li><li><a href="https://docs.opencv.org/3.4/files.html" class="has-submenu" id="sm-15715939272566555-5" aria-haspopup="true" aria-controls="sm-15715939272566555-6" aria-expanded="false"><span class="sub-arrow">+</span>Files</a><ul id="sm-15715939272566555-6" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-5" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/files.html">Files index</a></li><li><a href="https://docs.opencv.org/3.4/globals.html" class="has-submenu" id="sm-15715939272566555-7" aria-haspopup="true" aria-controls="sm-15715939272566555-8" aria-expanded="false"><span class="sub-arrow">+</span>Global objects</a><ul id="sm-15715939272566555-8" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-7" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/globals.html" class="has-submenu" id="sm-15715939272566555-9" aria-haspopup="true" aria-controls="sm-15715939272566555-10" aria-expanded="false"><span class="sub-arrow">+</span>All</a><ul id="sm-15715939272566555-10" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-9" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/globals.html#index__">_</a></li><li><a href="https://docs.opencv.org/3.4/globals_a.html#index_a">a</a></li><li><a href="https://docs.opencv.org/3.4/globals_c.html#index_c">c</a></li><li><a href="https://docs.opencv.org/3.4/globals_d.html#index_d">d</a></li><li><a href="https://docs.opencv.org/3.4/globals_f.html#index_f">f</a></li><li><a href="https://docs.opencv.org/3.4/globals_h.html#index_h">h</a></li><li><a href="https://docs.opencv.org/3.4/globals_i.html#index_i">i</a></li><li><a href="https://docs.opencv.org/3.4/globals_k.html#index_k">k</a></li><li><a href="https://docs.opencv.org/3.4/globals_l.html#index_l">l</a></li><li><a href="https://docs.opencv.org/3.4/globals_m.html#index_m">m</a></li><li><a href="https://docs.opencv.org/3.4/globals_n.html#index_n">n</a></li><li><a href="https://docs.opencv.org/3.4/globals_o.html#index_o">o</a></li><li><a href="https://docs.opencv.org/3.4/globals_p.html#index_p">p</a></li><li><a href="https://docs.opencv.org/3.4/globals_r.html#index_r">r</a></li><li><a href="https://docs.opencv.org/3.4/globals_s.html#index_s">s</a></li><li><a href="https://docs.opencv.org/3.4/globals_t.html#index_t">t</a></li><li><a href="https://docs.opencv.org/3.4/globals_u.html#index_u">u</a></li><li><a href="https://docs.opencv.org/3.4/globals_v.html#index_v">v</a></li></ul></li><li><a href="https://docs.opencv.org/3.4/globals_func.html" class="has-submenu" id="sm-15715939272566555-11" aria-haspopup="true" aria-controls="sm-15715939272566555-12" aria-expanded="false"><span class="sub-arrow">+</span>Functions</a><ul id="sm-15715939272566555-12" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-11" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/globals_func.html#index__">_</a></li><li><a href="https://docs.opencv.org/3.4/globals_func_a.html#index_a">a</a></li><li><a href="https://docs.opencv.org/3.4/globals_func_c.html#index_c">c</a></li><li><a href="https://docs.opencv.org/3.4/globals_func_h.html#index_h">h</a></li><li><a href="https://docs.opencv.org/3.4/globals_func_m.html#index_m">m</a></li><li><a href="https://docs.opencv.org/3.4/globals_func_n.html#index_n">n</a></li><li><a href="https://docs.opencv.org/3.4/globals_func_p.html#index_p">p</a></li><li><a href="https://docs.opencv.org/3.4/globals_func_u.html#index_u">u</a></li></ul></li><li><a href="https://docs.opencv.org/3.4/globals_vars.html">Variables</a></li><li><a href="https://docs.opencv.org/3.4/globals_type.html" class="has-submenu" id="sm-15715939272566555-13" aria-haspopup="true" aria-controls="sm-15715939272566555-14" aria-expanded="false"><span class="sub-arrow">+</span>Typedefs</a><ul id="sm-15715939272566555-14" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-13" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/globals_type.html#index_c">c</a></li><li><a href="https://docs.opencv.org/3.4/globals_type.html#index_i">i</a></li><li><a href="https://docs.opencv.org/3.4/globals_type.html#index_n">n</a></li><li><a href="https://docs.opencv.org/3.4/globals_type.html#index_s">s</a></li><li><a href="https://docs.opencv.org/3.4/globals_type.html#index_u">u</a></li><li><a href="https://docs.opencv.org/3.4/globals_type.html#index_v">v</a></li></ul></li><li><a href="https://docs.opencv.org/3.4/globals_enum.html">Enumerations</a></li><li><a href="https://docs.opencv.org/3.4/globals_eval.html" class="has-submenu" id="sm-15715939272566555-15" aria-haspopup="true" aria-controls="sm-15715939272566555-16" aria-expanded="false"><span class="sub-arrow">+</span>Enumerator</a><ul id="sm-15715939272566555-16" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-15" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/globals_eval.html#index_c">c</a></li><li><a href="https://docs.opencv.org/3.4/globals_eval_n.html#index_n">n</a></li></ul></li><li><a href="https://docs.opencv.org/3.4/globals_defs.html" class="has-submenu" id="sm-15715939272566555-17" aria-haspopup="true" aria-controls="sm-15715939272566555-18" aria-expanded="false"><span class="sub-arrow">+</span>Macros</a><ul id="sm-15715939272566555-18" role="group" aria-hidden="true" aria-labelledby="sm-15715939272566555-17" aria-expanded="false"><li><a href="https://docs.opencv.org/3.4/globals_defs.html#index__">_</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_c.html#index_c">c</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_d.html#index_d">d</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_f.html#index_f">f</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_h.html#index_h">h</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_i.html#index_i">i</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_l.html#index_l">l</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_m.html#index_m">m</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_n.html#index_n">n</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_o.html#index_o">o</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_r.html#index_r">r</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_s.html#index_s">s</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_t.html#index_t">t</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_u.html#index_u">u</a></li><li><a href="https://docs.opencv.org/3.4/globals_defs_v.html#index_v">v</a></li></ul></li></ul></li></ul></li><li><a href="https://docs.opencv.org/3.4/examples.html">Examples</a></li><li><a href="https://docs.opencv.org/3.4/javadoc/index.html">Java documentation</a></li><li style="float:right"><div id="MSearchBox" class="MSearchBoxInactive"><span class="left"><img id="MSearchSelect" src="OpenCV%20%20Optical%20Flow_elemei/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt=""><input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)"></span><span class="right"><a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" src="OpenCV%20%20Optical%20Flow_elemei/close.png" alt="" border="0"></a></span></div></li></ul></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" onclick="searchBox.OnSelectItem(0)" href="javascript:void(0)"><span class="SelectionMark">•</span>All</a><a class="SelectItem" onclick="searchBox.OnSelectItem(1)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" onclick="searchBox.OnSelectItem(2)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" onclick="searchBox.OnSelectItem(3)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" onclick="searchBox.OnSelectItem(4)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" onclick="searchBox.OnSelectItem(5)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" onclick="searchBox.OnSelectItem(6)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" onclick="searchBox.OnSelectItem(7)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" onclick="searchBox.OnSelectItem(8)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" onclick="searchBox.OnSelectItem(9)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Properties</a><a class="SelectItem" onclick="searchBox.OnSelectItem(10)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" onclick="searchBox.OnSelectItem(11)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Macros</a><a class="SelectItem" onclick="searchBox.OnSelectItem(12)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Modules</a><a class="SelectItem" onclick="searchBox.OnSelectItem(13)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" name="MSearchResults" id="MSearchResults" frameborder="0">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="https://docs.opencv.org/3.4/d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="https://docs.opencv.org/3.4/da/dd0/tutorial_table_of_content_video.html">Video analysis (video module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Optical Flow </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>In this chapter,</p><ul>
<li>We will understand the concepts of optical flow and its estimation using Lucas-Kanade method.</li>
<li>We will use functions like <b><a class="el" href="https://docs.opencv.org/3.4/dc/d6b/group__video__track.html#ga473e4b886d0bcc6b65831eb88ed93323" title="Calculates an optical flow for a sparse feature set using the iterative Lucas-Kanade method with pyra...">cv.calcOpticalFlowPyrLK()</a></b> to track feature points in a video.</li>
<li>We will create a dense optical flow field using the <b><a class="el" href="https://docs.opencv.org/3.4/dc/d6b/group__video__track.html#ga5d10ebbd59fe09c5f650289ec0ece5af" title="Computes a dense optical flow using the Gunnar Farneback's algorithm. ">cv.calcOpticalFlowFarneback()</a></b> method.</li>
</ul>
<h2>Optical Flow </h2>
<p>Optical flow is the pattern of apparent motion of image objects 
between two consecutive frames caused by the movement of object or 
camera. It is 2D vector field where each vector is a displacement vector
 showing the movement of points from first frame to second. Consider the
 image below (Image Courtesy: <a href="http://en.wikipedia.org/wiki/Optical_flow">Wikipedia article on Optical Flow</a>).</p>
<div class="image">
<img src="OpenCV%20%20Optical%20Flow_elemei/optical_flow_basic1.jpg" alt="optical_flow_basic1.jpg">
<div class="caption">
image</div></div>
<p> It shows a ball moving in 5 consecutive frames. The arrow shows its 
displacement vector. Optical flow has many applications in areas like :</p>
<ul>
<li>Structure from Motion</li>
<li>Video Compression</li>
<li>Video Stabilization ...</li>
</ul>
<p>Optical flow works on several assumptions:</p>
<ol type="1">
<li>The pixel intensities of an object do not change between consecutive frames.</li>
<li>Neighbouring pixels have similar motion.</li>
</ol>
<p>Consider a pixel <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1" style="width: 4.408em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.631em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.333em, 1003.54em, 2.69em, -1000em); top: -2.262em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math; font-style: italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.064em;"></span></span><span class="mo" id="MathJax-Span-4" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-5" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-6" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-7" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-8" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-9" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">t</span><span class="mo" id="MathJax-Span-10" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.262em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.371em; border-left: 0px solid; width: 0px; height: 1.343em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1">I(x,y,t)</script>
 in first frame (Check a new dimension, time, is added here. Earlier we 
were working with images only, so no need of time). It moves by distance
 <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-11" style="width: 4.051em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.333em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.333em, 1003.24em, 2.69em, -1000em); top: -2.262em; left: 0em;"><span class="mrow" id="MathJax-Span-12"><span class="mo" id="MathJax-Span-13" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-14" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-15" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-16" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-17" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-18" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-19" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.262em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.371em; border-left: 0px solid; width: 0px; height: 1.343em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-2">(dx,dy)</script> in next frame taken after <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-20" style="width: 1.074em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.33em, 1000.86em, 2.392em, -1000em); top: -2.202em; left: 0em;"><span class="mrow" id="MathJax-Span-21"><span class="mi" id="MathJax-Span-22" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.989em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-3">dt</script> time. So since those pixels are the same and intensity does not change, we can say,</p>
<p class="formulaDsp">
<span class="MathJax_Preview" style="display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-24" style="width: 18.217em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.179em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.333em, 1015.08em, 2.69em, -1000em); top: -2.262em; left: 0em;"><span class="mrow" id="MathJax-Span-25"><span class="mi" id="MathJax-Span-26" style="font-family: MathJax_Math; font-style: italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.064em;"></span></span><span class="mo" id="MathJax-Span-27" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-28" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-29" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-30" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-31" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-32" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">t</span><span class="mo" id="MathJax-Span-33" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-34" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-35" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.064em;"></span></span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-37" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-38" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-41" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-42" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-43" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-44" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-45" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-46" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">t</span><span class="mo" id="MathJax-Span-48" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-49" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-50" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-51" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.262em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.371em; border-left: 0px solid; width: 0px; height: 1.343em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-4">I(x,y,t) = I(x+dx, y+dy, t+dt)</script>
</p>
<p>Then take taylor series approximation of right-hand side, remove common terms and divide by <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-52" style="width: 1.074em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.33em, 1000.86em, 2.392em, -1000em); top: -2.202em; left: 0em;"><span class="mrow" id="MathJax-Span-53"><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-55" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.989em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5">dt</script> to get the following equation:</p>
<p class="formulaDsp">
<span class="MathJax_Preview" style="display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-56" style="width: 10.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.333em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.438em, 1008.33em, 2.795em, -1000em); top: -2.321em; left: 0em;"><span class="mrow" id="MathJax-Span-57"><span class="msubsup" id="MathJax-Span-58"><span style="display: inline-block; position: relative; width: 0.969em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-59" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-60" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mi" id="MathJax-Span-61" style="font-family: MathJax_Math; font-style: italic;">u</span><span class="mo" id="MathJax-Span-62" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-63" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-64" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-65" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mi" id="MathJax-Span-66" style="font-family: MathJax_Math; font-style: italic;">v</span><span class="mo" id="MathJax-Span-67" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-68" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.82em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-69" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-70" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-71" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-72" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span><span class="mspace" id="MathJax-Span-73" style="height: 0em; vertical-align: 0em; width: 0.278em; display: inline-block; overflow: hidden;"></span></span><span style="display: inline-block; width: 0px; height: 2.321em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.343em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-6">f_x u + f_y v + f_t = 0 \;</script>
</p>
<p>where:</p>
<p class="formulaDsp">
<span class="MathJax_Preview" style="display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-74" style="width: 10.241em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.512em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.675em, 1008.51em, 3.349em, -1000em); top: -2.262em; left: 0em;"><span class="mrow" id="MathJax-Span-75"><span class="msubsup" id="MathJax-Span-76"><span style="display: inline-block; position: relative; width: 0.969em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-77" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-78" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-79" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-80" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.258em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.095em, 1001.12em, 4.372em, -1000em); top: -4.682em; left: 50%; margin-left: -0.558em;"><span class="mrow" id="MathJax-Span-81"><span class="mi" id="MathJax-Span-82" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-83" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1001.09em, 4.189em, -1000em); top: -3.284em; left: 50%; margin-left: -0.569em;"><span class="mrow" id="MathJax-Span-84"><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-86" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(0.818em, 1001.26em, 1.25em, -1000em); top: -1.291em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.258em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.071em;"></span></span></span></span><span class="mspace" id="MathJax-Span-87" style="height: 0em; vertical-align: 0em; width: 0.278em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-88" style="font-family: MathJax_Main;">;</span><span class="mspace" id="MathJax-Span-89" style="height: 0em; vertical-align: 0em; width: 0.278em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-90" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-91" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-92" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-93" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-94" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.236em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.095em, 1001.12em, 4.372em, -1000em); top: -4.682em; left: 50%; margin-left: -0.558em;"><span class="mrow" id="MathJax-Span-95"><span class="mi" id="MathJax-Span-96" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-97" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(3.095em, 1001.06em, 4.372em, -1000em); top: -3.284em; left: 50%; margin-left: -0.531em;"><span class="mrow" id="MathJax-Span-98"><span class="mi" id="MathJax-Span-99" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-100" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(0.818em, 1001.24em, 1.25em, -1000em); top: -1.291em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.236em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.071em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.262em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.162em; border-left: 0px solid; width: 0px; height: 2.924em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-7">f_x = \frac{\partial f}{\partial x} \; ; \; f_y = \frac{\partial f}{\partial y}</script>
</p>
 <p class="formulaDsp">
<span class="MathJax_Preview" style="display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-101" style="width: 9.11em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.56em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.755em, 1007.56em, 3.197em, -1000em); top: -2.321em; left: 0em;"><span class="mrow" id="MathJax-Span-102"><span class="mi" id="MathJax-Span-103" style="font-family: MathJax_Math; font-style: italic;">u</span><span class="mo" id="MathJax-Span-104" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-105" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.215em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.116em, 1001.05em, 4.178em, -1000em); top: -4.665em; left: 50%; margin-left: -0.547em;"><span class="mrow" id="MathJax-Span-106"><span class="mi" id="MathJax-Span-107" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-108" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(3.116em, 1000.85em, 4.178em, -1000em); top: -3.302em; left: 50%; margin-left: -0.442em;"><span class="mrow" id="MathJax-Span-109"><span class="mi" id="MathJax-Span-110" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-111" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(0.818em, 1001.22em, 1.25em, -1000em); top: -1.291em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.215em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.071em;"></span></span></span></span><span class="mspace" id="MathJax-Span-112" style="height: 0em; vertical-align: 0em; width: 0.278em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-113" style="font-family: MathJax_Main;">;</span><span class="mspace" id="MathJax-Span-114" style="height: 0em; vertical-align: 0em; width: 0.278em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-115" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">v</span><span class="mo" id="MathJax-Span-116" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-117" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.139em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.116em, 1001.02em, 4.372em, -1000em); top: -4.682em; left: 50%; margin-left: -0.51em;"><span class="mrow" id="MathJax-Span-118"><span class="mi" id="MathJax-Span-119" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-120" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(3.116em, 1000.85em, 4.178em, -1000em); top: -3.302em; left: 50%; margin-left: -0.442em;"><span class="mrow" id="MathJax-Span-121"><span class="mi" id="MathJax-Span-122" style="font-family: MathJax_Math; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-123" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(0.818em, 1001.14em, 1.25em, -1000em); top: -1.291em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.139em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.071em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.321em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.908em; border-left: 0px solid; width: 0px; height: 2.645em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-8">u = \frac{dx}{dt} \; ; \; v = \frac{dy}{dt}</script>
</p>
<p>Above equation is called Optical Flow equation. In it, we can find <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-124" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.952em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.128em, 1000.95em, 1.395em, -1000em); top: -1.012em; left: 0em;"><span class="mrow" id="MathJax-Span-125"><span class="msubsup" id="MathJax-Span-126"><span style="display: inline-block; position: relative; width: 0.969em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-127" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-128" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 1.235em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-9">f_x</script> and <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-129" style="width: 1.074em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.893em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.128em, 1000.89em, 1.485em, -1000em); top: -1.012em; left: 0em;"><span class="mrow" id="MathJax-Span-130"><span class="msubsup" id="MathJax-Span-131"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-133" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.343em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-10">f_y</script>, they are image gradients. Similarly <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-134" style="width: 1.015em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.833em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.128em, 1000.83em, 1.395em, -1000em); top: -1.012em; left: 0em;"><span class="mrow" id="MathJax-Span-135"><span class="msubsup" id="MathJax-Span-136"><span style="display: inline-block; position: relative; width: 0.82em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-137" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-138" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 1.235em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-11">f_t</script> is the gradient along time. But <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-139" style="width: 2.741em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.262em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.333em, 1002.17em, 2.69em, -1000em); top: -2.262em; left: 0em;"><span class="mrow" id="MathJax-Span-140"><span class="mo" id="MathJax-Span-141" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-142" style="font-family: MathJax_Math; font-style: italic;">u</span><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-144" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">v</span><span class="mo" id="MathJax-Span-145" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.262em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.371em; border-left: 0px solid; width: 0px; height: 1.343em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-12">(u,v)</script>
 is unknown. We cannot solve this one equation with two unknown 
variables. So several methods are provided to solve this problem and one
 of them is Lucas-Kanade.</p>
<h3>Lucas-Kanade method</h3>
<p>We have seen an assumption before, that all the neighbouring pixels 
will have similar motion. Lucas-Kanade method takes a 3x3 patch around 
the point. So all the 9 points have the same motion. We can find <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-146" style="width: 5.241em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.345em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.333em, 1004.25em, 2.735em, -1000em); top: -2.262em; left: 0em;"><span class="mrow" id="MathJax-Span-147"><span class="mo" id="MathJax-Span-148" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-149"><span style="display: inline-block; position: relative; width: 0.969em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-150" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-151" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-152" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-153" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.916em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-154" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-155" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-156" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-157" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.82em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-158" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="mi" id="MathJax-Span-159" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-160" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.262em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.397em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-13">(f_x, f_y, f_t)</script>
 for these 9 points. So now our problem becomes solving 9 equations with
 two unknown variables which is over-determined. A better solution is 
obtained with least square fit method. Below is the final solution which
 is two equation-two unknown problem and solve to get the solution.</p>
<p class="formulaDsp">
<span class="MathJax_Preview" style="display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-161" style="width: 25.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.833em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.267em, 1020.59em, 4.821em, -1000em); top: -3.393em; left: 0em;"><span class="mrow" id="MathJax-Span-162"><span class="mrow" id="MathJax-Span-163"><span class="mo" id="MathJax-Span-164" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">[</span></span><span class="mtable" id="MathJax-Span-165" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.572em; height: 0px;"><span style="position: absolute; clip: rect(2.718em, 1000.55em, 4.928em, -1000em); top: -3.988em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.572em; height: 0px;"><span style="position: absolute; clip: rect(3.368em, 1000.55em, 4.178em, -1000em); top: -4.638em; left: 50%; margin-left: -0.286em;"><span class="mtd" id="MathJax-Span-166"><span class="mrow" id="MathJax-Span-167"><span class="mi" id="MathJax-Span-168" style="font-family: MathJax_Math; font-style: italic;">u</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(3.367em, 1000.47em, 4.178em, -1000em); top: -3.238em; left: 50%; margin-left: -0.242em;"><span class="mtd" id="MathJax-Span-169"><span class="mrow" id="MathJax-Span-170"><span class="mi" id="MathJax-Span-171" style="font-family: MathJax_Math; font-style: italic;">v</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-172" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">]</span></span></span><span class="mo" id="MathJax-Span-173" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-174" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 11.227em; height: 0px;"><span style="position: absolute; clip: rect(2.06em, 1009.98em, 5.416em, -1000em); top: -3.988em; left: 0em;"><span class="mrow" id="MathJax-Span-175"><span class="mo" id="MathJax-Span-176" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">[</span></span><span class="mtable" id="MathJax-Span-177" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 8.748em; height: 0px;"><span style="position: absolute; clip: rect(2.131em, 1003.87em, 5.345em, -1000em); top: -3.988em; left: 0em;"><span style="display: inline-block; position: relative; width: 3.874em; height: 0px;"><span style="position: absolute; clip: rect(2.907em, 1003.17em, 4.46em, -1000em); top: -4.764em; left: 50%; margin-left: -1.583em;"><span class="mtd" id="MathJax-Span-178"><span class="mrow" id="MathJax-Span-179"><span class="munderover" id="MathJax-Span-180"><span style="display: inline-block; position: relative; width: 1.375em; height: 0px;"><span style="position: absolute; clip: rect(3.06em, 1001em, 4.417em, -1000em); top: -3.988em; left: 0em;"><span class="mo" id="MathJax-Span-181" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.703em; left: 1.056em;"><span class="texatom" id="MathJax-Span-182"><span class="mrow" id="MathJax-Span-183"><span class="mi" id="MathJax-Span-184" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-185" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.624em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1001.2em, 4.428em, -1000em); top: -3.988em; left: 0em;"><span class="texatom" id="MathJax-Span-186"><span class="mrow" id="MathJax-Span-187"><span class="msubsup" id="MathJax-Span-188"><span style="display: inline-block; position: relative; width: 1.195em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-189" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-190"><span class="mrow" id="MathJax-Span-191"><span class="msubsup" id="MathJax-Span-192"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.497em, 1000.37em, 4.174em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-193" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.882em; left: 0.404em;"><span class="mi" id="MathJax-Span-194" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -4.42em; left: 1.195em;"><span class="mn" id="MathJax-Span-195" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(3.06em, 1003.87em, 4.492em, -1000em); top: -3.135em; left: 50%; margin-left: -1.937em;"><span class="mtd" id="MathJax-Span-219"><span class="mrow" id="MathJax-Span-220"><span class="munderover" id="MathJax-Span-221"><span style="display: inline-block; position: relative; width: 1.375em; height: 0px;"><span style="position: absolute; clip: rect(3.06em, 1001em, 4.417em, -1000em); top: -3.988em; left: 0em;"><span class="mo" id="MathJax-Span-222" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.703em; left: 1.056em;"><span class="texatom" id="MathJax-Span-223"><span class="mrow" id="MathJax-Span-224"><span class="mi" id="MathJax-Span-225" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="texatom" id="MathJax-Span-226" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-227"><span class="msubsup" id="MathJax-Span-228"><span style="display: inline-block; position: relative; width: 1.195em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-230"><span class="mrow" id="MathJax-Span-231"><span class="msubsup" id="MathJax-Span-232"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.497em, 1000.37em, 4.174em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-233" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.882em; left: 0.404em;"><span class="mi" id="MathJax-Span-234" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-235"><span style="display: inline-block; position: relative; width: 1.137em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-236" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-237"><span class="mrow" id="MathJax-Span-238"><span class="msubsup" id="MathJax-Span-239"><span style="display: inline-block; position: relative; width: 0.572em; height: 0px;"><span style="position: absolute; clip: rect(3.497em, 1000.35em, 4.312em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-240" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.818em; left: 0.346em;"><span class="mi" id="MathJax-Span-241" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(2.284em, 1003.87em, 5.345em, -1000em); top: -3.988em; left: 4.874em;"><span style="display: inline-block; position: relative; width: 3.874em; height: 0px;"><span style="position: absolute; clip: rect(3.06em, 1003.87em, 4.492em, -1000em); top: -4.764em; left: 50%; margin-left: -1.937em;"><span class="mtd" id="MathJax-Span-196"><span class="mrow" id="MathJax-Span-197"><span class="munderover" id="MathJax-Span-198"><span style="display: inline-block; position: relative; width: 1.375em; height: 0px;"><span style="position: absolute; clip: rect(3.06em, 1001em, 4.417em, -1000em); top: -3.988em; left: 0em;"><span class="mo" id="MathJax-Span-199" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.703em; left: 1.056em;"><span class="texatom" id="MathJax-Span-200"><span class="mrow" id="MathJax-Span-201"><span class="mi" id="MathJax-Span-202" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="texatom" id="MathJax-Span-203" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-204"><span class="msubsup" id="MathJax-Span-205"><span style="display: inline-block; position: relative; width: 1.195em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-206" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-207"><span class="mrow" id="MathJax-Span-208"><span class="msubsup" id="MathJax-Span-209"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.497em, 1000.37em, 4.174em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-210" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.882em; left: 0.404em;"><span class="mi" id="MathJax-Span-211" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-212"><span style="display: inline-block; position: relative; width: 1.137em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-213" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-214"><span class="mrow" id="MathJax-Span-215"><span class="msubsup" id="MathJax-Span-216"><span style="display: inline-block; position: relative; width: 0.572em; height: 0px;"><span style="position: absolute; clip: rect(3.497em, 1000.35em, 4.312em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-217" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.818em; left: 0.346em;"><span class="mi" id="MathJax-Span-218" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(2.907em, 1003.11em, 4.492em, -1000em); top: -3.135em; left: 50%; margin-left: -1.554em;"><span class="mtd" id="MathJax-Span-242"><span class="mrow" id="MathJax-Span-243"><span class="munderover" id="MathJax-Span-244"><span style="display: inline-block; position: relative; width: 1.375em; height: 0px;"><span style="position: absolute; clip: rect(3.06em, 1001em, 4.417em, -1000em); top: -3.988em; left: 0em;"><span class="mo" id="MathJax-Span-245" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.703em; left: 1.056em;"><span class="texatom" id="MathJax-Span-246"><span class="mrow" id="MathJax-Span-247"><span class="mi" id="MathJax-Span-248" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-249" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.566em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1001.14em, 4.492em, -1000em); top: -3.988em; left: 0em;"><span class="texatom" id="MathJax-Span-250"><span class="mrow" id="MathJax-Span-251"><span class="msubsup" id="MathJax-Span-252"><span style="display: inline-block; position: relative; width: 1.137em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-253" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-254"><span class="mrow" id="MathJax-Span-255"><span class="msubsup" id="MathJax-Span-256"><span style="display: inline-block; position: relative; width: 0.572em; height: 0px;"><span style="position: absolute; clip: rect(3.497em, 1000.35em, 4.312em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-257" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.818em; left: 0.346em;"><span class="mi" id="MathJax-Span-258" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -4.42em; left: 1.137em;"><span class="mn" id="MathJax-Span-259" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-260" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">]</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -5.465em; left: 10.248em;"><span class="texatom" id="MathJax-Span-261"><span class="mrow" id="MathJax-Span-262"><span class="mo" id="MathJax-Span-263" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-264" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mrow" id="MathJax-Span-265" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-266" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">[</span></span><span class="mtable" id="MathJax-Span-267" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 4.728em; height: 0px;"><span style="position: absolute; clip: rect(2.3em, 1004.73em, 5.226em, -1000em); top: -3.988em; left: 0em;"><span style="display: inline-block; position: relative; width: 4.728em; height: 0px;"><span style="position: absolute; clip: rect(3.06em, 1004.73em, 4.46em, -1000em); top: -4.747em; left: 50%; margin-left: -2.364em;"><span class="mtd" id="MathJax-Span-268"><span class="mrow" id="MathJax-Span-269"><span class="mo" id="MathJax-Span-270" style="font-family: MathJax_Main;">−</span><span class="munderover" id="MathJax-Span-271" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.375em; height: 0px;"><span style="position: absolute; clip: rect(3.06em, 1001em, 4.417em, -1000em); top: -3.988em; left: 0em;"><span class="mo" id="MathJax-Span-272" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.703em; left: 1.056em;"><span class="texatom" id="MathJax-Span-273"><span class="mrow" id="MathJax-Span-274"><span class="mi" id="MathJax-Span-275" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="texatom" id="MathJax-Span-276" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-277"><span class="msubsup" id="MathJax-Span-278"><span style="display: inline-block; position: relative; width: 1.195em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-279" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-280"><span class="mrow" id="MathJax-Span-281"><span class="msubsup" id="MathJax-Span-282"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.497em, 1000.37em, 4.174em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-283" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.882em; left: 0.404em;"><span class="mi" id="MathJax-Span-284" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-285"><span style="display: inline-block; position: relative; width: 1.046em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-286" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-287"><span class="mrow" id="MathJax-Span-288"><span class="msubsup" id="MathJax-Span-289"><span style="display: inline-block; position: relative; width: 0.481em; height: 0px;"><span style="position: absolute; clip: rect(3.367em, 1000.23em, 4.174em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-290" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.882em; left: 0.255em;"><span class="mi" id="MathJax-Span-291" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; clip: rect(3.06em, 1004.67em, 4.492em, -1000em); top: -3.254em; left: 50%; margin-left: -2.335em;"><span class="mtd" id="MathJax-Span-292"><span class="mrow" id="MathJax-Span-293"><span class="mo" id="MathJax-Span-294" style="font-family: MathJax_Main;">−</span><span class="munderover" id="MathJax-Span-295" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.375em; height: 0px;"><span style="position: absolute; clip: rect(3.06em, 1001em, 4.417em, -1000em); top: -3.988em; left: 0em;"><span class="mo" id="MathJax-Span-296" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.703em; left: 1.056em;"><span class="texatom" id="MathJax-Span-297"><span class="mrow" id="MathJax-Span-298"><span class="mi" id="MathJax-Span-299" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="texatom" id="MathJax-Span-300" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-301"><span class="msubsup" id="MathJax-Span-302"><span style="display: inline-block; position: relative; width: 1.137em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-303" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-304"><span class="mrow" id="MathJax-Span-305"><span class="msubsup" id="MathJax-Span-306"><span style="display: inline-block; position: relative; width: 0.572em; height: 0px;"><span style="position: absolute; clip: rect(3.497em, 1000.35em, 4.312em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-307" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.818em; left: 0.346em;"><span class="mi" id="MathJax-Span-308" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-309"><span style="display: inline-block; position: relative; width: 1.046em; height: 0px;"><span style="position: absolute; clip: rect(3.105em, 1000.55em, 4.372em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-310" style="font-family: MathJax_Math; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.838em; left: 0.49em;"><span class="texatom" id="MathJax-Span-311"><span class="mrow" id="MathJax-Span-312"><span class="msubsup" id="MathJax-Span-313"><span style="display: inline-block; position: relative; width: 0.481em; height: 0px;"><span style="position: absolute; clip: rect(3.367em, 1000.23em, 4.174em, -1000em); top: -3.988em; left: 0em;"><span class="mi" id="MathJax-Span-314" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span><span style="position: absolute; top: -3.882em; left: 0.255em;"><span class="mi" id="MathJax-Span-315" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.988em;"></span></span></span></span><span class="mo" id="MathJax-Span-316" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">]</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.393em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.571em; border-left: 0px solid; width: 0px; height: 3.979em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-14">\begin{bmatrix} u \\ v \end{bmatrix} = \begin{bmatrix} \sum_{i}{f_{x_i}}^2 & \sum_{i}{f_{x_i} f_{y_i} } \\ \sum_{i}{f_{x_i} f_{y_i}} & \sum_{i}{f_{y_i}}^2 \end{bmatrix}^{-1} \begin{bmatrix} - \sum_{i}{f_{x_i} f_{t_i}} \\ - \sum_{i}{f_{y_i} f_{t_i}} \end{bmatrix}</script>
</p>
<p>( Check similarity of inverse matrix with Harris corner detector. It denotes that corners are better points to be tracked.)</p>
<p>So from the user point of view, the idea is simple, we give some 
points to track, we receive the optical flow vectors of those points. 
But again there are some problems. Until now, we were dealing with small
 motions, so it fails when there is a large motion. To deal with this we
 use pyramids. When we go up in the pyramid, small motions are removed 
and large motions become small motions. So by applying Lucas-Kanade 
there, we get optical flow along with the scale.</p>
<h2>Lucas-Kanade Optical Flow in OpenCV <br><br><button class="toggleable_button label_cpp" style="border: 2px inset; border-radius: 4px; margin: 2px;">C++</button><button class="toggleable_button label_python" style="border: 2px outset; border-radius: 4px; margin: 2px;">Python</button></h2>
<p>OpenCV provides all these in a single function, <b><a class="el" href="https://docs.opencv.org/3.4/dc/d6b/group__video__track.html#ga473e4b886d0bcc6b65831eb88ed93323" title="Calculates an optical flow for a sparse feature set using the iterative Lucas-Kanade method with pyra...">cv.calcOpticalFlowPyrLK()</a></b>. Here, we create a simple application which tracks some points in a video. To decide the points, we use <b><a class="el" href="https://docs.opencv.org/3.4/dd/d1a/group__imgproc__feature.html#ga1d6bb77486c8f92d79c8793ad995d541" title="Determines strong corners on an image. ">cv.goodFeaturesToTrack()</a></b>.
 We take the first frame, detect some Shi-Tomasi corner points in it, 
then we iteratively track those points using Lucas-Kanade optical flow. 
For the function <b><a class="el" href="https://docs.opencv.org/3.4/dc/d6b/group__video__track.html#ga473e4b886d0bcc6b65831eb88ed93323" title="Calculates an optical flow for a sparse feature set using the iterative Lucas-Kanade method with pyra...">cv.calcOpticalFlowPyrLK()</a></b>
 we pass the previous frame, previous points and next frame. It returns 
next points along with some status numbers which has a value of 1 if 
next point is found, else zero. We iteratively pass these next points as
 previous points in next step. See the code below:</p>
 <div class="newInnerHTML" title="cpp" style="display: none;">C++</div><div class="toggleable_div label_cpp" style="display: block;"><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/3.4/samples/cpp/tutorial_code/video/optical_flow/optical_flow.cpp">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/da/d47/core_8hpp.html">opencv2/core.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/dd/d46/imgproc_8hpp.html">opencv2/imgproc.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/dc/d3d/videoio_8hpp.html">opencv2/videoio.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/d5/d71/video_8hpp.html">opencv2/video.hpp</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="https://docs.opencv.org/3.4/d2/d75/namespacecv.html">cv</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="https://docs.opencv.org/3.4/d8/dcc/namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> about =</div><div class="line">        <span class="stringliteral">"This sample demonstrates Lucas-Kanade Optical Flow calculation.\n"</span></div><div class="line">        <span class="stringliteral">"The example file can be downloaded from:\n"</span></div><div class="line">        <span class="stringliteral">"  https://www.bogotobogo.com/python/OpenCV_Python/images/mean_shift_tracking/slow_traffic_small.mp4"</span>;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> keys =</div><div class="line">        <span class="stringliteral">"{ h help |      | print this help message }"</span></div><div class="line">        <span class="stringliteral">"{ @image | vtest.avi | path to image file }"</span>;</div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser(argc, argv, keys);</div><div class="line">    parser.about(about);</div><div class="line">    <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">"help"</span>))</div><div class="line">    {</div><div class="line">        parser.printMessage();</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line">    <span class="keywordtype">string</span> filename = <a class="code" href="https://docs.opencv.org/3.4/d6/dba/group__core__utils__samples.html#ga3a33b00033b46c698ff6340d95569c13">samples::findFile</a>(parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">"@image"</span>));</div><div class="line">    <span class="keywordflow">if</span> (!parser.check())</div><div class="line">    {</div><div class="line">        parser.printErrors();</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d8/dfe/classcv_1_1VideoCapture.html">VideoCapture</a> capture(filename);</div><div class="line">    <span class="keywordflow">if</span> (!capture.isOpened()){</div><div class="line">        <span class="comment">//error in opening the video input</span></div><div class="line">        cerr &lt;&lt; <span class="stringliteral">"Unable to open file!"</span> &lt;&lt; endl;</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Create some random colors</span></div><div class="line">    vector&lt;Scalar&gt; colors;</div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d1/dd6/classcv_1_1RNG.html">RNG</a> rng;</div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 100; i++)</div><div class="line">    {</div><div class="line">        <span class="keywordtype">int</span> r = rng.<a class="code" href="https://docs.opencv.org/3.4/d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 256);</div><div class="line">        <span class="keywordtype">int</span> g = rng.<a class="code" href="https://docs.opencv.org/3.4/d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 256);</div><div class="line">        <span class="keywordtype">int</span> b = rng.<a class="code" href="https://docs.opencv.org/3.4/d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 256);</div><div class="line">        colors.push_back(<a class="code" href="https://docs.opencv.org/3.4/dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(r,g,b));</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> old_frame, old_gray;</div><div class="line">    vector&lt;Point2f&gt; p0, p1;</div><div class="line"></div><div class="line">    <span class="comment">// Take first frame and find corners in it</span></div><div class="line">    capture &gt;&gt; old_frame;</div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>(old_frame, old_gray, <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">COLOR_BGR2GRAY</a>);</div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/dd/d1a/group__imgproc__feature.html#ga1d6bb77486c8f92d79c8793ad995d541">goodFeaturesToTrack</a>(old_gray, p0, 100, 0.3, 7, <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a>(), 7, <span class="keyword">false</span>, 0.04);</div><div class="line"></div><div class="line">    <span class="comment">// Create a mask image for drawing purposes</span></div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> mask = <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#a0b57b6a326c8876d944d188a46e0f556">Mat::zeros</a>(old_frame.size(), old_frame.type());</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(<span class="keyword">true</span>){</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> frame, frame_gray;</div><div class="line"></div><div class="line">        capture &gt;&gt; frame;</div><div class="line">        <span class="keywordflow">if</span> (frame.empty())</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>(frame, frame_gray, <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">COLOR_BGR2GRAY</a>);</div><div class="line"></div><div class="line">        <span class="comment">// calculate optical flow</span></div><div class="line">        vector&lt;uchar&gt; status;</div><div class="line">        vector&lt;float&gt; err;</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d9/d5d/classcv_1_1TermCriteria.html">TermCriteria</a> criteria = <a class="code" href="https://docs.opencv.org/3.4/d9/d5d/classcv_1_1TermCriteria.html">TermCriteria</a>((<a class="code" href="https://docs.opencv.org/3.4/d9/d5d/classcv_1_1TermCriteria.html#a56fecdc291ccaba8aad27d67ccf72c57aeb9da694ea67b3ef7d524521b580867d">TermCriteria::COUNT</a>) + (<a class="code" href="https://docs.opencv.org/3.4/d9/d5d/classcv_1_1TermCriteria.html#a56fecdc291ccaba8aad27d67ccf72c57a857609e73e7028e638d2ea649f3b45d5">TermCriteria::EPS</a>), 10, 0.03);</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/dc/d6b/group__video__track.html#ga473e4b886d0bcc6b65831eb88ed93323">calcOpticalFlowPyrLK</a>(old_gray, frame_gray, p0, p1, status, err, <a class="code" href="https://docs.opencv.org/3.4/dc/d84/group__core__basic.html#ga346f563897249351a34549137c8532a0">Size</a>(15,15), 2, criteria);</div><div class="line"></div><div class="line">        vector&lt;Point2f&gt; good_new;</div><div class="line">        <span class="keywordflow">for</span>(<a class="code" href="https://docs.opencv.org/3.4/d1/d1b/group__core__hal__interface.html#ga4f5fce8c1ef282264f9214809524d836">uint</a> i = 0; i &lt; p0.size(); i++)</div><div class="line">        {</div><div class="line">            <span class="comment">// Select good points</span></div><div class="line">            <span class="keywordflow">if</span>(status[i] == 1) {</div><div class="line">                good_new.push_back(p1[i]);</div><div class="line">                <span class="comment">// draw the tracks</span></div><div class="line">                <a class="code" href="https://docs.opencv.org/3.4/d6/d6e/group__imgproc__draw.html#ga7078a9fae8c7e7d13d24dac2520ae4a2">line</a>(mask,p1[i], p0[i], colors[i], 2);</div><div class="line">                <a class="code" href="https://docs.opencv.org/3.4/d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">circle</a>(frame, p1[i], 5, colors[i], -1);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> img;</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga10ac1bfb180e2cfda1701d06c24fdbd6">add</a>(frame, mask, img);</div><div class="line"></div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">"Frame"</span>, img);</div><div class="line"></div><div class="line">        <span class="keywordtype">int</span> keyboard = <a class="code" href="https://docs.opencv.org/3.4/d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(30);</div><div class="line">        <span class="keywordflow">if</span> (keyboard == <span class="charliteral">'q'</span> || keyboard == 27)</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">        <span class="comment">// Now update the previous frame and previous points</span></div><div class="line">        old_gray = frame_gray.<a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#adff2ea98da45eae0833e73582dd4a660">clone</a>();</div><div class="line">        p0 = good_new;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment -->  </li></ul></div> 

 <div class="newInnerHTML" title="python" style="display: none;">Python</div><div class="toggleable_div label_python" style="display: none;"><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/3.4/samples/python/tutorial_code/video/optical_flow/optical_flow.py">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div><div class="line"><span class="keyword">import</span> argparse</div><div class="line"></div><div class="line">parser = argparse.ArgumentParser(description=<span class="stringliteral">'This sample demonstrates Lucas-Kanade Optical Flow calculation. \</span></div><div class="line"><span class="stringliteral">                                              The example file can be downloaded from: \</span></div><div class="line"><span class="stringliteral">                                              https://www.bogotobogo.com/python/OpenCV_Python/images/mean_shift_tracking/slow_traffic_small.mp4'</span>)</div><div class="line">parser.add_argument(<span class="stringliteral">'image'</span>, type=str, help=<span class="stringliteral">'path to image file'</span>)</div><div class="line">args = parser.parse_args()</div><div class="line"></div><div class="line">cap = <a class="code" href="https://docs.opencv.org/3.4/d8/dfe/classcv_1_1VideoCapture.html">cv.VideoCapture</a>(args.image)</div><div class="line"></div><div class="line"><span class="comment"># params for ShiTomasi corner detection</span></div><div class="line">feature_params = dict( maxCorners = 100,</div><div class="line">                       qualityLevel = 0.3,</div><div class="line">                       minDistance = 7,</div><div class="line">                       blockSize = 7 )</div><div class="line"></div><div class="line"><span class="comment"># Parameters for lucas kanade optical flow</span></div><div class="line">lk_params = dict( winSize  = (15,15),</div><div class="line">                  maxLevel = 2,</div><div class="line">                  criteria = (cv.TERM_CRITERIA_EPS | cv.TERM_CRITERIA_COUNT, 10, 0.03))</div><div class="line"></div><div class="line"><span class="comment"># Create some random colors</span></div><div class="line">color = np.random.randint(0,255,(100,3))</div><div class="line"></div><div class="line"><span class="comment"># Take first frame and find corners in it</span></div><div class="line">ret, old_frame = cap.read()</div><div class="line">old_gray = <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv.cvtColor</a>(old_frame, cv.COLOR_BGR2GRAY)</div><div class="line">p0 = <a class="code" href="https://docs.opencv.org/3.4/dd/d1a/group__imgproc__feature.html#gaaf8a051fb13cab1eba5e2149f75e902f">cv.goodFeaturesToTrack</a>(old_gray, mask = <span class="keywordtype">None</span>, **feature_params)</div><div class="line"></div><div class="line"><span class="comment"># Create a mask image for drawing purposes</span></div><div class="line">mask = np.zeros_like(old_frame)</div><div class="line"></div><div class="line">while(1):</div><div class="line">    ret,frame = cap.read()</div><div class="line">    frame_gray = <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv.cvtColor</a>(frame, cv.COLOR_BGR2GRAY)</div><div class="line"></div><div class="line">    <span class="comment"># calculate optical flow</span></div><div class="line">    p1, st, err = <a class="code" href="https://docs.opencv.org/3.4/dc/d6b/group__video__track.html#ga473e4b886d0bcc6b65831eb88ed93323">cv.calcOpticalFlowPyrLK</a>(old_gray, frame_gray, p0, <span class="keywordtype">None</span>, **lk_params)</div><div class="line"></div><div class="line">    <span class="comment"># Select good points</span></div><div class="line">    good_new = p1[st==1]</div><div class="line">    good_old = p0[st==1]</div><div class="line"></div><div class="line">    <span class="comment"># draw the tracks</span></div><div class="line">    <span class="keywordflow">for</span> i,(new,old) <span class="keywordflow">in</span> enumerate(zip(good_new, good_old)):</div><div class="line">        a,b = new.ravel()</div><div class="line">        c,d = old.ravel()</div><div class="line">        mask = <a class="code" href="https://docs.opencv.org/3.4/d6/d6e/group__imgproc__draw.html#ga7078a9fae8c7e7d13d24dac2520ae4a2">cv.line</a>(mask, (a,b),(c,d), color[i].tolist(), 2)</div><div class="line">        frame = <a class="code" href="https://docs.opencv.org/3.4/d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">cv.circle</a>(frame,(a,b),5,color[i].tolist(),-1)</div><div class="line">    img = <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga10ac1bfb180e2cfda1701d06c24fdbd6">cv.add</a>(frame,mask)</div><div class="line"></div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/df/d24/group__highgui__opengl.html#gaae7e90aa3415c68dba22a5ff2cefc25d">cv.imshow</a>(<span class="stringliteral">'frame'</span>,img)</div><div class="line">    k = <a class="code" href="https://docs.opencv.org/3.4/d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>(30) &amp; 0xff</div><div class="line">    <span class="keywordflow">if</span> k == 27:</div><div class="line">        <span class="keywordflow">break</span></div><div class="line"></div><div class="line">    <span class="comment"># Now update the previous frame and previous points</span></div><div class="line">    old_gray = frame_gray.copy()</div><div class="line">    p0 = good_new.reshape(-1,1,2)</div></div><!-- fragment -->  </li></ul></div> 

<p>(This code doesn't check how correct are the next keypoints. So even 
if any feature point disappears in image, there is a chance that optical
 flow finds the next point which may look close to it. So actually for a
 robust tracking, corner points should be detected in particular 
intervals. OpenCV samples comes up with such a sample which finds the 
feature points at every 5 frames. It also run a backward-check of the 
optical flow points got to select only good ones. Check 
samples/python/lk_track.py).</p>
<p>See the results we got:</p>
<div class="image">
<img src="OpenCV%20%20Optical%20Flow_elemei/opticalflow_lk.jpg" alt="opticalflow_lk.jpg">
<div class="caption">
image</div></div>
 <h2>Dense Optical Flow in OpenCV <br><br><button class="toggleable_button label_cpp" style="border: 2px inset; border-radius: 4px; margin: 2px;">C++</button><button class="toggleable_button label_python" style="border: 2px outset; border-radius: 4px; margin: 2px;">Python</button></h2>
<p>Lucas-Kanade method computes optical flow for a sparse feature set 
(in our example, corners detected using Shi-Tomasi algorithm). OpenCV 
provides another algorithm to find the dense optical flow. It computes 
the optical flow for all the points in the frame. It is based on Gunner 
Farneback's algorithm which is explained in "Two-Frame Motion Estimation
 Based on Polynomial Expansion" by Gunner Farneback in 2003.</p>
<p>Below sample shows how to find the dense optical flow using above 
algorithm. We get a 2-channel array with optical flow vectors, <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-317" style="width: 2.741em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.262em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.333em, 1002.17em, 2.69em, -1000em); top: -2.262em; left: 0em;"><span class="mrow" id="MathJax-Span-318"><span class="mo" id="MathJax-Span-319" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-320" style="font-family: MathJax_Math; font-style: italic;">u</span><span class="mo" id="MathJax-Span-321" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-322" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">v</span><span class="mo" id="MathJax-Span-323" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.262em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.371em; border-left: 0px solid; width: 0px; height: 1.343em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-15">(u,v)</script>.
 We find their magnitude and direction. We color code the result for 
better visualization. Direction corresponds to Hue value of the image. 
Magnitude corresponds to Value plane. See the code below:</p>
 <div class="newInnerHTML" title="cpp" style="display: none;">C++</div><div class="toggleable_div label_cpp" style="display: block;"><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/3.4/samples/cpp/tutorial_code/video/optical_flow/optical_flow_dense.cpp">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/da/d47/core_8hpp.html">opencv2/core.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/dd/d46/imgproc_8hpp.html">opencv2/imgproc.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/dc/d3d/videoio_8hpp.html">opencv2/videoio.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="https://docs.opencv.org/3.4/d5/d71/video_8hpp.html">opencv2/video.hpp</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="https://docs.opencv.org/3.4/d2/d75/namespacecv.html">cv</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="https://docs.opencv.org/3.4/d8/dcc/namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d8/dfe/classcv_1_1VideoCapture.html">VideoCapture</a> capture(<a class="code" href="https://docs.opencv.org/3.4/d6/dba/group__core__utils__samples.html#ga3a33b00033b46c698ff6340d95569c13">samples::findFile</a>(<span class="stringliteral">"vtest.avi"</span>));</div><div class="line">    <span class="keywordflow">if</span> (!capture.isOpened()){</div><div class="line">        <span class="comment">//error in opening the video input</span></div><div class="line">        cerr &lt;&lt; <span class="stringliteral">"Unable to open file!"</span> &lt;&lt; endl;</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> frame1, prvs;</div><div class="line">    capture &gt;&gt; frame1;</div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>(frame1, prvs, <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">COLOR_BGR2GRAY</a>);</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(<span class="keyword">true</span>){</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> frame2, next;</div><div class="line">        capture &gt;&gt; frame2;</div><div class="line">        <span class="keywordflow">if</span> (frame2.empty())</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>(frame2, next, <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">COLOR_BGR2GRAY</a>);</div><div class="line"></div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> flow(prvs.<a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code" href="https://docs.opencv.org/3.4/d1/d1b/group__core__hal__interface.html#ga15d6109d87682bf909122d0ce51c46a6">CV_32FC2</a>);</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/dc/d6b/group__video__track.html#ga5d10ebbd59fe09c5f650289ec0ece5af">calcOpticalFlowFarneback</a>(prvs, next, flow, 0.5, 3, 15, 3, 5, 1.2, 0);</div><div class="line"></div><div class="line">        <span class="comment">// visualization</span></div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> flow_parts[2];</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga0547c7fed86152d7e9d0096029c8518a">split</a>(flow, flow_parts);</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga6d3b097586bca4409873d64a90fe64c3">magnitude</a>, angle, magn_norm;</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#gac5f92f48ec32cacf5275969c33ee837d">cartToPolar</a>(flow_parts[0], flow_parts[1], magnitude, angle, <span class="keyword">true</span>);</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>(magnitude, magn_norm, 0.0f, 1.0f, <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>);</div><div class="line">        angle *= ((1.f / 360.f) * (180.f / 255.f));</div><div class="line"></div><div class="line">        <span class="comment">//build hsv image</span></div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html">Mat</a> _hsv[3], hsv, hsv8, bgr;</div><div class="line">        _hsv[0] = angle;</div><div class="line">        _hsv[1] = <a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#a69ae0402d116fc9c71908d8508dc2f09">Mat::ones</a>(angle.<a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code" href="https://docs.opencv.org/3.4/d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>);</div><div class="line">        _hsv[2] = magn_norm;</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(_hsv, 3, hsv);</div><div class="line">        hsv.<a class="code" href="https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(hsv8, <a class="code" href="https://docs.opencv.org/3.4/d1/d1b/group__core__hal__interface.html#ga32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>, 255.0);</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>(hsv8, bgr, <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#gga4e0972be5de079fed4e3a10e24ef5ef0a2a4b11ff7d29c342b66b85962a7969cd">COLOR_HSV2BGR</a>);</div><div class="line"></div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">"frame2"</span>, bgr);</div><div class="line"></div><div class="line">        <span class="keywordtype">int</span> keyboard = <a class="code" href="https://docs.opencv.org/3.4/d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(30);</div><div class="line">        <span class="keywordflow">if</span> (keyboard == <span class="charliteral">'q'</span> || keyboard == 27)</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">        prvs = next;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment -->  </li></ul></div> 

 <div class="newInnerHTML" title="python" style="display: none;">Python</div><div class="toggleable_div label_python" style="display: none;"><ul>
<li><b>Downloadable code</b>: Click <a href="https://github.com/opencv/opencv/tree/3.4/samples/python/tutorial_code/video/optical_flow/optical_flow_dense.py">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div><div class="line">cap = <a class="code" href="https://docs.opencv.org/3.4/d8/dfe/classcv_1_1VideoCapture.html">cv.VideoCapture</a>(<a class="code" href="https://docs.opencv.org/3.4/d6/dba/group__core__utils__samples.html#ga3a33b00033b46c698ff6340d95569c13">cv.samples.findFile</a>(<span class="stringliteral">"vtest.avi"</span>))</div><div class="line">ret, frame1 = cap.read()</div><div class="line">prvs = <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv.cvtColor</a>(frame1,cv.COLOR_BGR2GRAY)</div><div class="line">hsv = np.zeros_like(frame1)</div><div class="line">hsv[...,1] = 255</div><div class="line">while(1):</div><div class="line">    ret, frame2 = cap.read()</div><div class="line">    next = <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv.cvtColor</a>(frame2,cv.COLOR_BGR2GRAY)</div><div class="line">    flow = <a class="code" href="https://docs.opencv.org/3.4/dc/d6b/group__video__track.html#ga5d10ebbd59fe09c5f650289ec0ece5af">cv.calcOpticalFlowFarneback</a>(prvs,next, <span class="keywordtype">None</span>, 0.5, 3, 15, 3, 5, 1.2, 0)</div><div class="line">    mag, ang = <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#gac5f92f48ec32cacf5275969c33ee837d">cv.cartToPolar</a>(flow[...,0], flow[...,1])</div><div class="line">    hsv[...,0] = ang*180/np.pi/2</div><div class="line">    hsv[...,2] = <a class="code" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga7bcf47a1df78cf575162e0aed44960cb">cv.normalize</a>(mag,<span class="keywordtype">None</span>,0,255,cv.NORM_MINMAX)</div><div class="line">    bgr = <a class="code" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">cv.cvtColor</a>(hsv,cv.COLOR_HSV2BGR)</div><div class="line">    <a class="code" href="https://docs.opencv.org/3.4/df/d24/group__highgui__opengl.html#gaae7e90aa3415c68dba22a5ff2cefc25d">cv.imshow</a>(<span class="stringliteral">'frame2'</span>,bgr)</div><div class="line">    k = <a class="code" href="https://docs.opencv.org/3.4/d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv.waitKey</a>(30) &amp; 0xff</div><div class="line">    <span class="keywordflow">if</span> k == 27:</div><div class="line">        <span class="keywordflow">break</span></div><div class="line">    <span class="keywordflow">elif</span> k == ord(<span class="stringliteral">'s'</span>):</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv.imwrite</a>(<span class="stringliteral">'opticalfb.png'</span>,frame2)</div><div class="line">        <a class="code" href="https://docs.opencv.org/3.4/d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv.imwrite</a>(<span class="stringliteral">'opticalhsv.png'</span>,bgr)</div><div class="line">    prvs = next</div></div><!-- fragment -->  </li></ul></div> 

<p>See the result below:</p>
<div class="image">
<img src="OpenCV%20%20Optical%20Flow_elemei/opticalfb.jpg" alt="opticalfb.jpg">
<div class="caption">
image</div></div>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"><address class="footer"><small>
Generated on Sun Oct 20 2019 04:39:43 for OpenCV by &nbsp;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="OpenCV%20%20Optical%20Flow_elemei/doxygen.png" alt="doxygen">
</a> 1.8.12
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>


<table style="width: 183px; display: none; top: 32px; left: 0px; position: absolute;" class="gstl_50 gssb_c" cellspacing="0" cellpadding="0"><tbody><tr><td class="gssb_f"></td><td class="gssb_e" style="width: 100%;"></td></tr></tbody></table><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px none; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px none; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: MathJax_Size4, sans-serif;"></div></div></body></html>